using System;

namespace Il2CppDumper
{
	public class MetadataDecryption
	{
		public struct StringDecryptionData
		{
			public uint stringCountXor;

			public uint stringOffsetXor;

			public uint stringLiteralOffsetXor;

			public uint stringLiteralDataCountXor;

			public uint stringLiteralDataOffsetXor;

			public byte[] stringDecryptionBlob;
		}

		public static readonly uint[] BlkStuff1p2 = new uint[256]
		{
			1471508552u, 1417135463u, 3300299523u, 2437718819u, 3430493986u, 4132903174u, 2890563253u, 2484168530u, 1390982201u, 4051694260u,
			2523154577u, 576620268u, 4224016726u, 3503927004u, 2270605631u, 2293360300u, 1313355207u, 1611218492u, 2669440604u, 3872553540u,
			90680282u, 367184024u, 2760229524u, 3253426034u, 3763145498u, 2458785292u, 3966298534u, 3712734860u, 714160845u, 3560173633u,
			779838544u, 1138380183u, 1838892652u, 2137721581u, 1814879360u, 3663936830u, 2975688103u, 280956137u, 1639883984u, 3005762148u,
			525884282u, 2233704188u, 1730270606u, 1114494843u, 3882213544u, 2210197410u, 464651751u, 2470022368u, 1601883241u, 519029142u,
			2155764365u, 2968190795u, 616691634u, 3843084139u, 1352506362u, 767152511u, 3829675u, 80752950u, 2640920991u, 2719658954u,
			4120226857u, 3048684346u, 3178792731u, 1536201460u, 739134355u, 2510749118u, 4158686186u, 2800807255u, 3404095100u, 3534520607u,
			410038472u, 2381062877u, 2587994669u, 2806478779u, 905121308u, 1928950461u, 1056835346u, 2919097433u, 26080583u, 1443031716u,
			4271416615u, 974412175u, 2836904644u, 1102013012u, 2996818056u, 38748264u, 1757839901u, 4161262713u, 602479616u, 2432383439u,
			3411133584u, 1888247166u, 3125832873u, 2409172254u, 1061789182u, 3707522144u, 1075378360u, 3994928741u, 3456893153u, 118653977u,
			2224292880u, 1342156587u, 2875364615u, 1231085173u, 4243426020u, 1361707286u, 432482852u, 539732271u, 1674283795u, 649386097u,
			3594968962u, 1027387965u, 3061157397u, 150328202u, 3582225069u, 2575507202u, 1222067353u, 2771540088u, 1851388739u, 285775365u,
			229119995u, 3795330265u, 1156752933u, 436576011u, 203394327u, 2866089963u, 3199873588u, 3485178381u, 2181789006u, 1259729334u,
			3167690231u, 4201839546u, 2553578990u, 3152541253u, 3257524829u, 862748482u, 1899743122u, 3688146898u, 1877895599u, 1692623009u,
			3452876238u, 395831131u, 1194332938u, 654525085u, 2050412188u, 4281286603u, 371228087u, 1790160350u, 1279072772u, 4095882949u,
			3946840596u, 3622913390u, 1795438386u, 2662069424u, 4250537992u, 628518238u, 3281942705u, 489518265u, 3745446223u, 3900880699u,
			3227307422u, 3334716608u, 4189081237u, 823742593u, 3365106111u, 801963708u, 563884995u, 2746034470u, 3817848373u, 176225353u,
			2631850867u, 1700067917u, 3305179631u, 4020919433u, 1508228407u, 4072490907u, 3113408902u, 2072073328u, 2923385206u, 3019940310u,
			1015752913u, 2691669001u, 1769019633u, 2091499458u, 241869524u, 4077575543u, 111484661u, 2944977818u, 1652298239u, 2046065587u,
			266156088u, 3791294966u, 3733545891u, 3374639955u, 3541769203u, 3513660464u, 2829066280u, 909228851u, 931537375u, 3346277932u,
			816761453u, 2715289317u, 3082949881u, 315237162u, 1300922600u, 4039665752u, 155339110u, 686036238u, 2328152431u, 1252158298u,
			1398746837u, 3625325309u, 3836171655u, 479915605u, 3205343448u, 2017714527u, 66640516u, 1512507416u, 1952842723u, 693342178u,
			1561322410u, 1438670731u, 876909808u, 341135988u, 2339591043u, 2099127598u, 2298903616u, 2385418226u, 3912576471u, 853271982u,
			3942095096u, 1000588131u, 1590515333u, 945911372u, 2128384001u, 3089449834u, 3990844234u, 1555593542u, 327006662u, 2177482849u,
			2262903763u, 970386592u, 723951649u, 1481779163u, 1976670479u, 188180133u, 2354821169u, 1183287782u, 1980967968u, 3651242001u,
			2616602817u, 2547241597u, 1721126754u, 2007283404u, 1934551121u, 1162165449u
		};

		public static readonly uint[] BlkStuff1p3 = new uint[256]
		{
			2699482441u, 1649670730u, 2735054554u, 1496694415u, 1824112594u, 1116707816u, 1609050290u, 82956170u, 4246905932u, 1784949231u,
			1910377608u, 1259368764u, 3505900517u, 3426238926u, 1126671001u, 2758816150u, 1570986576u, 480813438u, 167297409u, 3354188280u,
			1916618523u, 4150134027u, 2421426618u, 4274122719u, 1486718974u, 2608894348u, 2105490418u, 1581257155u, 2225885236u, 644275402u,
			1861406000u, 3487238749u, 2396057971u, 2124181601u, 961158514u, 1990960068u, 1223899823u, 2862248974u, 2872200575u, 1037892013u,
			1305339649u, 906518939u, 876811129u, 2017584732u, 1886795257u, 2843295645u, 2811460101u, 739933581u, 1868231745u, 4200008448u,
			1808535710u, 4285126318u, 3563138874u, 89782011u, 2282579790u, 2890392115u, 804861470u, 3316099866u, 2094465667u, 254105532u,
			2151331051u, 2729289643u, 1829865123u, 2231658821u, 467471922u, 3010143115u, 4111824873u, 3850095288u, 4090028500u, 3105325772u,
			1697010950u, 4189339795u, 1413263492u, 1390487225u, 3868754219u, 3974373484u, 3952185120u, 3899835571u, 2556680735u, 394017096u,
			2368977632u, 30347812u, 36460983u, 3136604511u, 2319848876u, 1524036892u, 3541336182u, 306373862u, 4236942653u, 4004467342u,
			1146228181u, 2580276078u, 1174025380u, 2359002001u, 1544250145u, 3923443138u, 225322334u, 139524336u, 429292752u, 118653977u,
			2173865370u, 3929650769u, 1996724917u, 1967712343u, 4162615778u, 1066896207u, 3535583495u, 1044361790u, 3726478973u, 2706304056u,
			1397301192u, 690266147u, 1612220584u, 3762624278u, 2449223883u, 2525601671u, 3268543574u, 667870651u, 1281744496u, 486578191u,
			3179374099u, 766657788u, 3878729818u, 269063684u, 169576978u, 3231282868u, 2946804128u, 2920059089u, 518247324u, 6761301u,
			3666569890u, 1735206884u, 554922886u, 4066433189u, 1014284508u, 2045370157u, 777064303u, 3241234373u, 4227805809u, 4143332474u,
			3676525523u, 2188494345u, 629512025u, 382992441u, 592970084u, 984176353u, 904604168u, 2788901748u, 680302930u, 933255402u,
			1435798005u, 3839095753u, 295808885u, 3194105216u, 1334220259u, 1677443899u, 2347642077u, 954344451u, 728748737u, 2535565046u,
			1230701534u, 3593100760u, 2782398695u, 214309935u, 2263294678u, 3647480113u, 2309316159u, 3099573181u, 2586355965u, 2506806292u,
			3410882178u, 1097650299u, 345993947u, 3217691889u, 4029393479u, 2832271084u, 2270108583u, 2495802725u, 717745072u, 355945386u,
			2663271458u, 2047513790u, 1687055479u, 3156828002u, 2134133008u, 525069037u, 2961729560u, 2640119729u, 1770480252u, 3790417511u,
			3366888721u, 4010241023u, 2633318080u, 830328535u, 244149965u, 2074258895u, 3048650166u, 606973480u, 2478260777u, 1638969817u,
			3143430190u, 3448797375u, 3615646889u, 3753228044u, 2669049171u, 3724461550u, 1474296599u, 4051931958u, 3512726164u, 3086862164u,
			1253591117u, 59007174u, 2999130874u, 2407057410u, 406734241u, 1450689126u, 3981187357u, 849249604u, 1939177066u, 1176076087u,
			443889475u, 3586725451u, 1359113514u, 1086646538u, 1724194453u, 196326243u, 334159255u, 989949840u, 549145335u, 3463656236u,
			3792594420u, 3059088933u, 3636467776u, 1960890662u, 3372653664u, 819328934u, 3404060659u, 2918177602u, 1747933965u, 3696688287u,
			4106047128u, 3279568167u, 859225141u, 1202800198u, 3289354859u, 586168341u, 1311681682u, 2451536728u, 112901480u, 3021900999u,
			3819330693u, 3326402697u, 2212102008u, 2971685225u, 1535036525u, 1353339995u
		};

		public static readonly uint[] BlkStuff1p4 = new uint[256]
		{
			4081308862u, 1181538172u, 268978109u, 539497031u, 2888388466u, 2584573276u, 4257099585u, 3831043866u, 926077411u, 1908372084u,
			3415872879u, 99066197u, 3797776590u, 769086418u, 842269789u, 1705446330u, 3066875203u, 3174556418u, 3981909015u, 4182730201u,
			684820076u, 1267963625u, 1100949390u, 3564716768u, 2282840902u, 2500268421u, 1789751139u, 1434934848u, 3116804506u, 1934251832u,
			3881545072u, 3466379473u, 3311922832u, 2313616480u, 1603006247u, 3191167336u, 3870044758u, 2413990836u, 668721845u, 3379507235u,
			3631324243u, 502728232u, 1451615274u, 1416675686u, 1671652462u, 1823015095u, 2263652537u, 267063346u, 1331879025u, 1117625828u,
			3649438581u, 2084582369u, 1958324170u, 1281386011u, 418501526u, 1383378610u, 3969942321u, 2990376923u, 3264487010u, 817963281u,
			790787742u, 3090233020u, 68173427u, 301979803u, 3365449477u, 2125797037u, 14775531u, 1851532795u, 3715582445u, 34886055u,
			868457339u, 2715160295u, 690362698u, 4105184332u, 2367141624u, 4055298546u, 2216279541u, 1733439222u, 1984725638u, 1773131017u,
			640449939u, 3666131231u, 969878044u, 3781149348u, 1401106836u, 3278078276u, 18279373u, 1467120396u, 2668339426u, 3133412336u,
			1201358938u, 3732272007u, 4020386139u, 2383744146u, 519420994u, 3479920631u, 2075378451u, 1164864790u, 2213170439u, 118653977u,
			2266695583u, 740347124u, 369895529u, 1568590443u, 166690790u, 2182992417u, 2838469324u, 707044128u, 135848128u, 1534764479u,
			1552504141u, 825671223u, 220083582u, 1350667262u, 3919992463u, 2617842312u, 3348286428u, 3681756729u, 1883827538u, 353276419u,
			2498793123u, 2815582515u, 623822841u, 469801230u, 236752660u, 2363501022u, 2973711793u, 419843248u, 4131717376u, 1925040158u,
			2667331524u, 2024896889u, 115678015u, 1968060652u, 1633042722u, 4232687719u, 1150939696u, 618223839u, 3936677093u, 3819628520u,
			918900421u, 1683002524u, 2416034875u, 3247875080u, 1301805373u, 3166731300u, 4273771819u, 785770936u, 2567950134u, 3050207017u,
			2166319179u, 3328529658u, 3023693839u, 2008751520u, 2466479697u, 3998590589u, 4223287445u, 4155678246u, 2051300405u, 875588489u,
			1318404951u, 1070286280u, 3449715387u, 3549082130u, 4071902104u, 2109189319u, 2965938839u, 2855084198u, 1027498116u, 2135067019u,
			1484267477u, 2034689631u, 2330215946u, 3749866657u, 1044175598u, 3297800630u, 1519205017u, 3615225994u, 3531418932u, 584922891u,
			2883239808u, 520233828u, 2616912506u, 1019871138u, 568298849u, 1585213441u, 2650703278u, 1217473667u, 2465522039u, 4172872447u,
			3140717782u, 318595825u, 3769130370u, 1750616623u, 2566410256u, 3074118245u, 2736991147u, 943240506u, 2731848845u, 2770814079u,
			1231467429u, 2246976211u, 2549232841u, 2686554561u, 65261185u, 3948114883u, 3396176457u, 2516954095u, 1248070095u, 3897674153u,
			2917060692u, 2448841501u, 3599525804u, 1834917777u, 735263750u, 1649736520u, 1502576883u, 2333333804u, 2162751341u, 216640088u,
			1621220868u, 3699431115u, 402372431u, 3514799966u, 3498575992u, 2787507733u, 4283107853u, 351866149u, 2933680702u, 1722134992u,
			468937212u, 1080604840u, 3582909894u, 4115118954u, 319487447u, 3227597614u, 4030820052u, 4199407539u, 986550390u, 1131020994u,
			2832729578u, 1873525469u, 589998125u, 2765151065u, 436532954u, 3853420604u, 993660752u, 183354764u, 2938893592u, 186276522u,
			3016366333u, 1366693080u, 3429492125u, 902296751u, 1801121861u, 3217213006u
		};

		public static readonly uint[] BlkStuff1p5 = new uint[256]
		{
			1447175149u, 2034360664u, 500244494u, 1032116798u, 1020915634u, 417579396u, 2881084643u, 1283557370u, 658996777u, 2867128687u,
			2407789269u, 4063741979u, 1223578620u, 3267710771u, 563265580u, 2996643707u, 3646676648u, 578133923u, 1116375795u, 1525892327u,
			3289444662u, 2248176725u, 2326860639u, 1825865162u, 83221398u, 310843531u, 3103391348u, 2462637387u, 3544123303u, 1606526317u,
			1312550393u, 2304134352u, 1920470491u, 4083875223u, 2658777665u, 550499744u, 3114585080u, 4144310673u, 3463718969u, 2057748183u,
			1678429894u, 3801134339u, 2423437128u, 1700264778u, 3069375357u, 3163957874u, 4178453656u, 4270239505u, 2001398865u, 2282453340u,
			2476075207u, 1436908642u, 2888914794u, 1978697298u, 3829730054u, 1631072076u, 3038096626u, 672220844u, 2173239260u, 3568798766u,
			937427761u, 614474150u, 94957082u, 3930981903u, 2369362134u, 2692755552u, 4108482078u, 1236493936u, 1658810563u, 29833756u,
			3591235117u, 3281550015u, 865064759u, 2779959786u, 35677587u, 2741465071u, 204171418u, 1203268473u, 1494489960u, 3124991095u,
			971705912u, 2435809988u, 3669786919u, 1247033855u, 2527529293u, 1981274589u, 58544159u, 1743622473u, 506888065u, 3515182500u,
			2396964697u, 1617238720u, 3081750257u, 10096528u, 3760905984u, 2127129297u, 2790624869u, 2080082779u, 4292582045u, 118653977u,
			244384409u, 895117618u, 431944712u, 1801254467u, 4209605399u, 138722460u, 973885879u, 825605428u, 225860886u, 1865622085u,
			2630078530u, 589867567u, 195289875u, 2484953934u, 3015709431u, 478942594u, 2271035865u, 1722852549u, 1568395118u, 453287435u,
			3843571338u, 3354898105u, 995189819u, 353342210u, 152668432u, 4122952594u, 715861167u, 333065479u, 1352113640u, 2824766316u,
			3920189824u, 2767184998u, 4035813912u, 1538158955u, 1138212735u, 1546058466u, 2355408218u, 3436069434u, 2977593588u, 3211884029u,
			3503839272u, 1157759354u, 340960910u, 2201130463u, 2188353619u, 3588929954u, 2835592928u, 3229558064u, 442084231u, 3689002155u,
			184473247u, 1891788760u, 746492586u, 2928360809u, 384355469u, 1076945136u, 2950039781u, 2802367465u, 1372235876u, 637342762u,
			2161494608u, 3738391841u, 2347509459u, 2669973453u, 2715616748u, 2721733219u, 3711175342u, 951466932u, 737548579u, 1461655137u,
			1837713478u, 1399898727u, 4056979348u, 2549759169u, 692876064u, 2246519770u, 2561410116u, 1852708809u, 1757129164u, 3366032956u,
			3475578293u, 397801729u, 4017940357u, 3697884962u, 3390831679u, 1776720960u, 3943904131u, 2226789974u, 3782732428u, 2909561574u,
			639257509u, 3908332556u, 3184205822u, 1306309238u, 3989212550u, 784660649u, 918369981u, 757311270u, 3240235196u, 852681403u,
			1931819095u, 4222897819u, 3886175369u, 872897726u, 4132969501u, 1189437173u, 2015155412u, 272462472u, 1906266708u, 1147090166u,
			3410414003u, 3821895823u, 2582720968u, 1258884211u, 3333069621u, 1097717116u, 2585161287u, 105886101u, 4251054238u, 4231841042u,
			3024656766u, 2504021698u, 3995193865u, 1778500559u, 2644436430u, 812157112u, 1587319009u, 3969628170u, 3388777392u, 2955365752u,
			3875496197u, 2100180318u, 2605407179u, 1378744299u, 527125005u, 1957540830u, 1425557998u, 1481191140u, 3624332068u, 2140430173u,
			3448993718u, 3190571121u, 1061072957u, 3310208186u, 291522308u, 3139346939u, 798608677u, 4166193428u, 1046709681u, 265041685u,
			3750650029u, 1669481807u, 2087911634u, 3529650731u, 1332140149u, 3612398497u
		};

		public static readonly byte[] BlkStuff1p6 = new byte[256]
		{
			173, 247, 151, 41, 203, 204, 92, 192, 72, 182,
			86, 106, 114, 1, 38, 11, 147, 13, 212, 110,
			112, 197, 22, 111, 211, 104, 166, 160, 39, 60,
			8, 43, 139, 165, 73, 238, 125, 24, 250, 229,
			57, 154, 64, 223, 145, 40, 18, 158, 199, 224,
			108, 170, 227, 19, 237, 122, 177, 157, 103, 141,
			174, 73, 16, 229, 205, 70, 75, 216, 61, 210,
			33, 174, 99, 18, 233, 120, 238, 215, 7, 34,
			195, 222, 229, 252, 86, 71, 16, 114, 249, 179,
			227, 243, 4, 47, 60, 36, 15, 70, 54, 156,
			23, 38, 74, 146, 96, 114, 205, 145, 43, 33,
			212, 150, 95, 162, 147, 3, 65, 181, 134, 138,
			70, 41, 56, 135, 130, 145, 11, 235, 69, 239,
			108, 61, 52, 29, 165, 146, 224, 132, 186, 186,
			131, 198, 151, 3, 249, 194, 25, 78, 140, 199,
			92, 237, 133, 159, 82, 140, 127, 23, 190, 14,
			24, 175, 71, 45, 70, 115, 156, 209, 56, 225,
			55, 90, 249, 74, 239, 75, 179, 24, 115, 7,
			141, 152, 48, 104, 221, 157, 133, 186, 59, 143,
			27, 180, 32, 227, 149, 15, 179, 61, 254, 9,
			134, 36, 37, 109, 20, 178, 221, 111, 79, 127,
			82, 133, 50, 159, 99, 37, 10, 195, 95, 187,
			176, 235, 189, 207, 191, 254, 38, 81, 181, 48,
			236, 168, 223, 253, 174, 40, 144, 65, 136, 113,
			24, 37, 9, 114, 177, 125, 223, 46, 230, 111,
			17, 103, 86, 35, 13, 125
		};

		private static byte XorCombine(byte[] input, int offset, int size = 16)
		{
			byte ret = 0;
			for (int i = offset; i < offset + size; i++)
			{
				ret ^= input[i];
			}
			return ret;
		}

		private static void CompressKey(byte[] data, byte[] key)
		{
			for (int i = 0; i < 176; i++)
			{
				key[i] = XorCombine(data, 16 * i);
			}
		}

		private static void NotBlkKeyScramble(byte[] key, byte[] data, int offset)
		{
			for (int i = 0; i < 16; i++)
			{
				data[i + offset] ^= key[i];
			}
			byte[] indexScramble = new byte[16]
			{
				0, 13, 10, 7, 4, 1, 14, 11, 8, 5,
				2, 15, 12, 9, 6, 3
			};
			uint[] scratch = new uint[4];
			byte[] scratchByte = new byte[16];
			for (int j = 1; j < 10; j++)
			{
				for (int k = 0; k < 4; k++)
				{
					scratch[k] = 0u;
				}
				for (int l = 0; l < 4; l++)
				{
					scratch[l] ^= BlkStuff1p2[data[indexScramble[4 * l] + offset]];
					scratch[l] ^= BlkStuff1p3[data[indexScramble[4 * l + 1] + offset]];
					scratch[l] ^= BlkStuff1p4[data[indexScramble[4 * l + 2] + offset]];
					scratch[l] ^= BlkStuff1p5[data[indexScramble[4 * l + 3] + offset]];
				}
				Buffer.BlockCopy(scratch, 0, scratchByte, 0, scratchByte.Length);
				for (int m = 0; m < 16; m++)
				{
					data[m + offset] = (byte)(scratchByte[m] ^ key[16 * j + m]);
				}
			}
			for (int n = 0; n < 16; n++)
			{
				byte t = data[indexScramble[n] + offset];
				scratchByte[n] = (byte)(BlkStuff1p6[t] ^ ~t);
			}
			for (int num = 0; num < 16; num++)
			{
				data[num + offset] = (byte)(scratchByte[num] ^ key[160 + num]);
			}
		}

		private static StringDecryptionData DecryptMetadataStringInfo(byte[] metadata)
		{
			StringDecryptionData data = default(StringDecryptionData);
			uint[] values = new uint[18];
			Buffer.BlockCopy(metadata, 96, values, 0, 16);
			Buffer.BlockCopy(metadata, 320, values, 16, 16);
			Buffer.BlockCopy(metadata, 256, values, 32, 16);
			Buffer.BlockCopy(metadata, 240, values, 48, 8);
			Buffer.BlockCopy(metadata, 8, values, 56, 16);
			ulong seed = ((ulong)values[values[0] & 0xF] << 32) | values[(values[17] & 0xF) + 2];
			MT19937_64 rand = new MT19937_64(seed);
			data.stringCountXor = (uint)rand.Int63();
			data.stringOffsetXor = (uint)rand.Int63();
			rand.Int63();
			data.stringLiteralOffsetXor = (uint)rand.Int63();
			data.stringLiteralDataCountXor = (uint)rand.Int63();
			data.stringLiteralDataOffsetXor = (uint)rand.Int63();
			ulong[] stringDecryptionBlob = new ulong[2560];
			for (int i = 0; i < stringDecryptionBlob.Length; i++)
			{
				stringDecryptionBlob[i] = rand.Int63();
			}
			data.stringDecryptionBlob = new byte[20480];
			Buffer.BlockCopy(stringDecryptionBlob, 0, data.stringDecryptionBlob, 0, 20480);
			return data;
		}

		private static void DecryptMetadataBlocks(byte[] metadata)
		{
			byte[] footer = new byte[16384];
			Buffer.BlockCopy(metadata, metadata.Length - footer.Length, footer, 0, footer.Length);
			if (footer[200] != 46 || footer[201] != 252 || footer[202] != 254 || footer[203] != 44)
			{
				throw new ArgumentException("*((uint32_t*)&footer[0xC8]) != 0x2CFEFC2E");
			}
			byte[] out1 = new byte[2816];
			byte[] out2 = new byte[16];
			ushort offset = (ushort)((footer[211] << 8) | footer[210]);
			Buffer.BlockCopy(footer, offset, out2, 0, out2.Length);
			Buffer.BlockCopy(footer, offset + 16, out1, 0, out1.Length);
			for (int i = 0; i < 16; i++)
			{
				out2[i] ^= footer[12288 + i];
			}
			for (int j = 0; j < 2816; j++)
			{
				out1[j] ^= (byte)(footer[12304 + j] ^ out2[j % 16]);
			}
			byte[] temp = new byte[16];
			byte[] scratch = new byte[16];
			byte[] hardKey = new byte[16]
			{
				173, 47, 66, 48, 103, 4, 176, 156, 157, 42,
				192, 186, 14, 191, 165, 104
			};
			byte[] key = new byte[176];
			CompressKey(out1, key);
			int entrySize = metadata.Length / 256 / 64 * 64;
			for (int k = 0; k < 256; k++)
			{
				int off = k * entrySize;
				for (int l = 0; l < 16; l++)
				{
					temp[l] = (byte)(out2[l] ^ hardKey[l]);
				}
				for (int m = 0; m < 64; m += 16)
				{
					Buffer.BlockCopy(temp, 0, scratch, 0, 16);
					Buffer.BlockCopy(metadata, off + m, temp, 0, 16);
					NotBlkKeyScramble(key, metadata, off + m);
					for (int n = 0; n < 16; n++)
					{
						metadata[off + m + n] ^= scratch[n];
					}
				}
			}
		}

		public static StringDecryptionData DecryptMetadata(byte[] metadata)
		{
			DecryptMetadataBlocks(metadata);
			return DecryptMetadataStringInfo(metadata);
		}
	}
}
